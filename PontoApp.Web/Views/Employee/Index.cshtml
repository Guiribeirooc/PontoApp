@model IEnumerable<PontoApp.Domain.Entities.Employee>
@{
    ViewData["Title"] = "Colaboradores";
}

<style>
    .emp-photo-thumb {
        height: 40px;
        border-radius: 6px;
        cursor: zoom-in;
        transition: transform .08s ease-in-out;
    }

        .emp-photo-thumb:hover {
            transform: scale(1.04);
        }
</style>

<h2>Colaboradores</h2>

<p>
    <a asp-action="Create" class="btn btn-primary">Novo(a) Colaborador(a)</a>
</p>

<table class="table table-striped align-middle">
    <thead>
        <tr>
            <th>Foto</th>
            <th>Nome</th>
            <th>PIN</th>
            <th>Status</th>
            <th style="width:200px"></th>
        </tr>
    </thead>
    <tbody>
        @foreach (var e in Model)
        {
            var rowClass = e.Ativo ? "" : "table-secondary text-muted";
            <tr class="@rowClass">
                <td>
                    @if (!string.IsNullOrEmpty(e.PhotoPath))
                    {
                        <img src="@e.PhotoPath"
                             alt="Foto de @e.Nome"
                             class="emp-photo-thumb"
                             data-full="@e.PhotoPath" />
                    }
                </td>
                <td>@e.Nome</td>
                <td>@e.Cpf</td>
                <td>@e.Pin</td>
                <td>@(e.Ativo ? "Ativa" : "Inativa")</td>
                <td>
                    <div class="d-flex gap-2">
                        <a asp-action="Edit" asp-route-id="@e.Id" class="btn btn-sm btn-secondary">Editar</a>

                        <form asp-action="ToggleStatus" asp-route-id="@e.Id" method="post" class="m-0">
                            @Html.AntiForgeryToken()
                            <button type="submit" class="btn btn-sm @(e.Ativo ? "btn-warning" : "btn-success")">
                                @(e.Ativo ? "Desativar" : "Ativar")
                            </button>
                        </form>
                        <form asp-action="Delete" asp-route-id="@e.Id" method="post" class="d-inline m-0"
                              onsubmit="return confirm('Excluir definitivamente este colaborador? Esta ação não pode ser desfeita.');">
                            @Html.AntiForgeryToken()
                            <button type="submit" class="btn btn-sm btn-danger">Excluir</button>
                        </form>

                    </div>
                </td>
            </tr>
        }
    </tbody>
</table>

<div class="modal fade" id="photoModal" tabindex="-1" aria-labelledby="photoModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content" style="background: transparent; border: none;">
            <button type="button" class="btn-close btn-close-white ms-auto me-1 mt-1" data-bs-dismiss="modal" aria-label="Fechar"></button>
            <img id="photoModalImg" class="img-fluid rounded shadow" alt="Foto do(a) colaborador(a)" />
            <div id="photoModalCaption" class="text-center text-white mt-2 fw-semibold"></div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function () {
          const modalEl = document.getElementById('photoModal');
          const modalImg = document.getElementById('photoModalImg');
          const modalCaption = document.getElementById('photoModalCaption');

          // Bootstrap 5
          const bsModal = new bootstrap.Modal(modalEl);

          document.querySelectorAll('.emp-photo-thumb').forEach(img => {
            img.addEventListener('click', () => {
              modalImg.src = img.dataset.full;
              modalCaption.textContent = img.alt || '';
              bsModal.show();
            });
          });

          modalEl.addEventListener('hidden.bs.modal', () => {
            modalImg.src = '';
            modalCaption.textContent = '';
          });
        });
    </script>
}
